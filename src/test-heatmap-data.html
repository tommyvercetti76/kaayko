<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Heatmap Data Structure</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Heatmap Data Structure Test</h1>
    
    <div class="test-section">
        <h2>API Response Structure</h2>
        <div id="api-response"></div>
    </div>
    
    <div class="test-section">
        <h2>Transformed Data for Heatmap</h2>
        <div id="transformed-data"></div>
    </div>
    
    <div class="test-section">
        <h2>Hourly Data Analysis</h2>
        <div id="hourly-analysis"></div>
    </div>

    <script>
        async function testAPIResponse() {
            try {
                const response = await fetch('https://api-vwcc5j4qda-uc.a.run.app/paddlePredict/forecast?lat=21.15&lng=79.1');
                const data = await response.json();
                
                document.getElementById('api-response').innerHTML = `
                    <div class="success">✅ API Response received</div>
                    <pre>${JSON.stringify(data, null, 2).substring(0, 3000)}...</pre>
                `;
                
                // Analyze hourly data structure
                if (data.forecast && data.forecast.length > 0) {
                    const firstDay = data.forecast[0];
                    const availableHours = Object.keys(firstDay.hourly || {});
                    
                    document.getElementById('hours-analysis').innerHTML = `
                        <div class="success">Available hours for ${firstDay.date}: [${availableHours.join(', ')}]</div>
                        <div>Total hours available: ${availableHours.length}</div>
                        <div>Expected: 24 hours (0-23)</div>
                        <div>Status: ${availableHours.length === 24 ? '✅ Full hourly data!' : '⚠️ Limited data (' + availableHours.length + ' hours)'}</div>
                    `;
                    
                    // Analyze period breakdown
                    const morningHours = ['6', '7', '8', '9', '10', '11'];
                    const noonHours = ['12', '13', '14', '15', '16', '17'];
                    const eveningHours = ['18', '19', '20', '21', '22', '23'];
                    
                    const morningAvailable = morningHours.filter(h => availableHours.includes(h));
                    const noonAvailable = noonHours.filter(h => availableHours.includes(h));
                    const eveningAvailable = eveningHours.filter(h => availableHours.includes(h));
                    
                    document.getElementById('hourly-analysis').innerHTML = `
                        <h3>Period Breakdown:</h3>
                        <div>Morning (6-11): ${morningAvailable.length}/6 hours available [${morningAvailable.join(', ')}]</div>
                        <div>Noon (12-17): ${noonAvailable.length}/6 hours available [${noonAvailable.join(', ')}]</div>
                        <div>Evening (18-23): ${eveningAvailable.length}/6 hours available [${eveningAvailable.join(', ')}]</div>
                        
                        <h3>Sample Hour Data (Hour 12):</h3>
                        <pre>${JSON.stringify(firstDay.hourly['12'] || 'No data', null, 2)}</pre>
                        
                        <h3>Sample Hour Data (Hour 0):</h3>
                        <pre>${JSON.stringify(firstDay.hourly['0'] || 'No data', null, 2)}</pre>
                    `;
                    
                    // Test what our transformer would do
                    const transformedData = data.forecast.map(day => ({
                        date: day.date,
                        hourly: day.hourly || {}
                    }));
                    
                    document.getElementById('transformed-data').innerHTML = `
                        <div class="success">✅ Data transformed for heatmap</div>
                        <div>Each day has ${Object.keys(transformedData[0]?.hourly || {}).length} hourly data points</div>
                        <div>Ready for period-based display:</div>
                        <ul>
                            <li>Morning: 6 hourly tiles (6-11)</li>
                            <li>Noon: 6 hourly tiles (12-17)</li>  
                            <li>Evening: 6 hourly tiles (18-23)</li>
                        </ul>
                    `;
                } else {
                    document.getElementById('hours-analysis').innerHTML = `
                        <div class="error">❌ No forecast data available</div>
                    `;
                }
                
            } catch (error) {
                document.getElementById('api-response').innerHTML = `
                    <div class="error">❌ API Error: ${error.message}</div>
                `;
            }
        }
        
        // Run test when page loads
        testAPIResponse();
    </script>
</body>
</html>
